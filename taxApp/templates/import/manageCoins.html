{% extends 'taxApp/basePage.html' %}

{% block content %}
    <div class="centeredGrid">
        <div class="d-flex flex-column">
            <h3 class="centeredGrid">Manage Coins</h3>

            <div class="d-flex flex-row justify-content-center">
                <button class="btn btn-primary m-1" data-bs-target="#newToken" data-bs-toggle="collapse">Add New Token</button>
{#                <button class="btn btn-primary m-1" data-bs-target="#manualTtx" data-bs-toggle="collapse" data-action="{% url 'ajaxImportTx' %}">Create Token Transfer</button>#}
            </div>
            <div id="newToken" class="collapse">
                <form id="newTokenForm" method="post" action="{% url 'ajaxNewToken' %}">
                    {% csrf_token %}
                    <div class="d-flex flex-column justify-content-center">
                        <div class="mt-1">
                            {{ tokenForm.address.label_tag }}
                            {{ tokenForm.address }}
                        </div>
                        <div class="mt-1">
                            {{ tokenForm.chain.label_tag }}
                            {{ tokenForm.chain }}
                        </div>
                        <div class="mt-1">
                            {{ tokenForm.coin_id.label_tag }}
                                <select
                                    class="form-control coinselect"
                                    id="id_coin_id"
                                    name="coin_id"
                                    autocomplete="off"
                                    data-url={% url 'ajaxSearchCoins' %}
                                    data-addClass="form-select"
                                >
                                </select>
                        </div>
                        <div class="mt-1">
                            <button id="submitToken" data-form="newTokenForm" type="button" class="btn btn-primary btn-submit">Submit</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}

{% block inlineJS %}
    <script>
        $(document).ready(function() {

            $(".coinselect").autoComplete();

            $(".btn-submit").click(async function(event) {
                event.preventDefault();
                $("#message").slideUp();
                let form = $(this).data('form')
                let res = await postForm($(`#${form}`))
                if (res.msg){
                    $("#messageContent").text(res.msg);
                    $("#message").slideDown();
                }
            });
        });
    </script>
{% endblock %}